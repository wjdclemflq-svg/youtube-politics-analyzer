<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>대규모 정치 유튜브 분석 대시보드</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    :root { 
      --bg: #f8fafc; 
      --card: #ffffff; 
      --muted: #64748b; 
      --text: #1e293b; 
      --accent: #3b82f6; 
      --success: #10b981;
      --warning: #f59e0b;
      --error: #ef4444;
      --border: #e2e8f0;
      --hover: #f1f5f9;
      --purple: #8b5cf6;
      --orange: #f97316;
    }
    
    * { box-sizing: border-box }
    body { 
      margin: 0; 
      font-family: Inter, system-ui, 'Segoe UI', Roboto, sans-serif; 
      background: var(--bg); 
      color: var(--text);
      line-height: 1.5;
    }
    
    .wrap { max-width: 1600px; margin: 0 auto; padding: 24px }
    
    /* 헤더 */
    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 24px;
    }
    
    .title-section h1 {
      font-size: 32px;
      margin: 0 0 8px;
      font-weight: 700;
      background: linear-gradient(135deg, var(--accent), var(--purple));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }
    
    .subtitle {
      color: var(--muted);
      font-size: 16px;
    }
    
    .header-stats {
      display: flex;
      gap: 24px;
      align-items: center;
    }
    
    .stat-badge {
      text-align: center;
      padding: 8px 16px;
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 12px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
    }
    
    .stat-badge .number {
      font-size: 24px;
      font-weight: 700;
      color: var(--accent);
      margin: 0;
    }
    
    .stat-badge .label {
      font-size: 12px;
      color: var(--muted);
      margin: 0;
    }
    
    /* 상태 표시줄 */
    .status-bar {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 16px 20px;
      margin-bottom: 24px;
      display: grid;
      grid-template-columns: 1fr auto auto;
      gap: 20px;
      align-items: center;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
    }
    
    .status-main {
      display: flex;
      align-items: center;
      gap: 12px;
    }
    
    .status-indicator {
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .status-dot {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      background: var(--success);
      animation: pulse 2s infinite;
    }
    
    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }
    
    .status-dot.loading { background: var(--warning); }
    .status-dot.error { background: var(--error); }
    
    .data-sources {
      display: flex;
      gap: 8px;
    }
    
    .source-badge {
      padding: 4px 8px;
      border-radius: 6px;
      font-size: 11px;
      font-weight: 500;
      text-transform: uppercase;
    }
    
    .source-badge.github { background: #f3f4f6; color: #374151; }
    .source-badge.apps-script { background: #dbeafe; color: #1e40af; }
    .source-badge.rss { background: #fef3c7; color: #92400e; }
    .source-badge.social { background: #ecfdf5; color: #065f46; }
    
    /* 탭 */
    .tabs { 
      display: flex; 
      gap: 8px; 
      margin-bottom: 24px;
      border-bottom: 1px solid var(--border);
      padding-bottom: 8px;
    }
    
    .tab { 
      padding: 12px 20px; 
      background: transparent; 
      border: none;
      border-radius: 8px; 
      color: var(--muted); 
      cursor: pointer;
      font-weight: 500;
      transition: all 0.2s ease;
      position: relative;
    }
    
    .tab.active { 
      color: var(--accent);
      background: var(--hover);
    }
    
    .tab.active::after {
      content: '';
      position: absolute;
      bottom: -9px;
      left: 50%;
      transform: translateX(-50%);
      width: 40px;
      height: 3px;
      background: var(--accent);
      border-radius: 2px;
    }
    
    .tab:hover:not(.active) {
      background: var(--hover);
    }
    
    /* 카드 */
    .card { 
      background: var(--card); 
      border: 1px solid var(--border); 
      border-radius: 16px; 
      padding: 24px; 
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
      margin-bottom: 24px;
    }
    
    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }
    
    .card-title {
      font-size: 18px;
      font-weight: 600;
      margin: 0;
      color: var(--text);
    }
    
    /* 그리드 레이아웃 */
    .grid {
      display: grid;
      gap: 24px;
    }
    
    .grid-2 { grid-template-columns: 1fr 1fr; }
    .grid-3 { grid-template-columns: 1fr 1fr 1fr; }
    .grid-4 { grid-template-columns: repeat(4, 1fr); }
    
    /* 테이블 */
    .table-container {
      overflow: auto;
      max-height: 500px;
      border: 1px solid var(--border);
      border-radius: 12px;
      background: var(--card);
    }
    
    table { 
      width: 100%; 
      border-collapse: collapse; 
      font-size: 14px;
      min-width: 800px;
    }
    
    th, td { 
      padding: 16px; 
      border-bottom: 1px solid var(--border); 
      text-align: left;
    }
    
    th { 
      background: #f8fafc;
      color: var(--text); 
      font-weight: 600;
      position: sticky;
      top: 0;
      z-index: 10;
      border-bottom: 2px solid var(--border);
    }
    
    tr:hover { 
      background: var(--hover); 
    }
    
    tr:last-child td {
      border-bottom: none;
    }
    
    .thumb { 
      width: 60px; 
      height: 40px; 
      object-fit: cover; 
      border-radius: 8px; 
      border: 1px solid var(--border);
    }
    
    .video-thumb {
      width: 84px;
      height: 56px;
      object-fit: cover;
      border-radius: 10px;
      border: 1px solid var(--border);
    }
    
    .title { 
      font-weight: 600; 
      color: var(--accent); 
      cursor: pointer;
      text-decoration: none;
    }
    .title:hover { text-decoration: underline; }
    
    .positive { color: var(--success); font-weight: 600; }
    .negative { color: var(--error); font-weight: 600; }
    
    .chip { 
      padding: 6px 12px; 
      border: 1px solid var(--border); 
      border-radius: 20px; 
      color: var(--accent); 
      font-size: 12px;
      background: #eff6ff;
      font-weight: 500;
    }
    
    /* 메트릭 카드 */
    .metric-cards {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 16px;
      margin-bottom: 24px;
    }
    
    .metric-card {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 20px;
      text-align: center;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
    }
    
    .metric-value {
      font-size: 28px;
      font-weight: 700;
      margin: 8px 0;
    }
    
    .metric-value.channels { color: var(--accent); }
    .metric-value.videos { color: var(--success); }
    .metric-value.views { color: var(--purple); }
    .metric-value.trends { color: var(--orange); }
    
    .metric-label {
      font-size: 14px;
      color: var(--muted);
      font-weight: 500;
    }
    
    .metric-change {
      font-size: 12px;
      margin-top: 4px;
    }
    
    .metric-change.up { color: var(--success); }
    .metric-change.down { color: var(--error); }
    
    /* 모달 스타일 */
    .modal {
      display: none;
      position: fixed;
      z-index: 1000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.5);
      animation: fadeIn 0.3s;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    
    .modal-content {
      background-color: #ffffff;
      margin: 3% auto;
      padding: 0;
      border-radius: 8px;
      width: 90%;
      max-width: 1000px;
      max-height: 90vh;
      overflow: hidden;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      animation: slideIn 0.3s;
    }
    
    @keyframes slideIn {
      from { transform: translateY(-50px); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }
    
    .modal-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 16px 24px;
      border-bottom: 1px solid #e5e7eb;
      background: #fafafa;
    }
    
    .modal-body {
      padding: 24px;
      max-height: calc(90vh - 60px);
      overflow-y: auto;
      background: #ffffff;
    }
    
    .close {
      color: #6b7280;
      font-size: 24px;
      font-weight: normal;
      cursor: pointer;
      transition: color 0.2s;
      line-height: 1;
      padding: 0;
    }
    
    .close:hover {
      color: #374151;
    }
    
    /* 스크롤바 */
    .table-container::-webkit-scrollbar,
    .modal-body::-webkit-scrollbar {
      width: 8px;
      height: 8px;
    }
    
    .table-container::-webkit-scrollbar-track,
    .modal-body::-webkit-scrollbar-track {
      background: #f1f5f9;
      border-radius: 4px;
    }
    
    .table-container::-webkit-scrollbar-thumb,
    .modal-body::-webkit-scrollbar-thumb {
      background: #cbd5e1;
      border-radius: 4px;
    }
    
    .table-container::-webkit-scrollbar-thumb:hover,
    .modal-body::-webkit-scrollbar-thumb:hover {
      background: #94a3b8;
    }
    
    /* 반응형 */
    @media (max-width: 1200px) {
      .grid-4 { grid-template-columns: repeat(2, 1fr); }
      .grid-3 { grid-template-columns: repeat(2, 1fr); }
    }
    
    @media (max-width: 768px) {
      .wrap { padding: 16px; }
      .header { flex-direction: column; gap: 16px; text-align: center; }
      .header-stats { justify-content: center; }
      .status-bar { grid-template-columns: 1fr; gap: 12px; }
      .grid-2, .grid-3, .grid-4 { grid-template-columns: 1fr; }
      .channel-info { grid-template-columns: repeat(2, 1fr); }
      .modal-content { width: 95%; margin: 2% auto; }
      table { font-size: 13px; }
      th, td { padding: 12px; }
    }
    
    /* 로딩 애니메이션 */
    .loading-spinner {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 2px solid var(--border);
      border-top: 2px solid var(--accent);
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
  </style>
</head>
<body>
  <div class="wrap">
    <!-- 헤더 -->
    <div class="header">
      <div class="title-section">
        <h1>대규모 정치 유튜브 분석 대시보드</h1>
        <p class="subtitle">멀티소스 실시간 데이터 통합 분석 플랫폼</p>
      </div>
      <div class="header-stats">
        <div class="stat-badge">
          <div id="total-channels" class="number">-</div>
          <div class="label">채널</div>
        </div>
        <div class="stat-badge">
          <div id="total-videos" class="number">-</div>
          <div class="label">동영상</div>
        </div>
        <div class="stat-badge">
          <div id="total-views" class="number">-</div>
          <div class="label">총 조회수</div>
        </div>
      </div>
    </div>
    
    <!-- 상태 표시줄 -->
    <div class="status-bar">
      <div class="status-main">
        <div class="status-indicator">
          <div id="status-dot" class="status-dot"></div>
          <span id="status-text">시스템 초기화 중...</span>
        </div>
        <div class="loading-spinner" id="loading-spinner" style="display: none;"></div>
      </div>
      
      <div class="data-sources">
        <span class="source-badge github">GitHub</span>
        <span class="source-badge apps-script">Apps Script</span>
        <span class="source-badge rss">RSS</span>
        <span class="source-badge social">Social</span>
      </div>
      
      <div id="last-updated">마지막 업데이트: -</div>
    </div>
    
    <!-- 메트릭 카드 -->
    <div class="metric-cards">
      <div class="metric-card">
        <div class="metric-value channels" id="metric-channels">-</div>
        <div class="metric-label">모니터링 채널</div>
        <div class="metric-change up" id="metric-channels-change">+5.2%</div>
      </div>
      <div class="metric-card">
        <div class="metric-value videos" id="metric-videos">-</div>
        <div class="metric-label">수집 동영상</div>
        <div class="metric-change up" id="metric-videos-change">+12.8%</div>
      </div>
      <div class="metric-card">
        <div class="metric-value views" id="metric-views">-</div>
        <div class="metric-label">총 조회수</div>
        <div class="metric-change up" id="metric-views-change">+8.4%</div>
      </div>
      <div class="metric-card">
        <div class="metric-value trends" id="metric-trends">-</div>
        <div class="metric-label">트렌드 지표</div>
        <div class="metric-change up" id="metric-trends-change">+15.6%</div>
      </div>
    </div>
    
    <!-- 탭 -->
    <div class="tabs">
      <button class="tab active" data-tab="overview">📊 전체 현황</button>
      <button class="tab" data-tab="analysis">🔥 급상승 분석</button>
      <button class="tab" data-tab="trends">📈 트렌드</button>
      <button class="tab" data-tab="social">💬 소셜 반응</button>
      <button class="tab" data-tab="system">⚙️ 시스템 현황</button>
    </div>

    <!-- 전체 현황 탭 -->
    <section id="overview" class="tab-content">
      <div class="card">
        <div class="card-header">
          <h3 class="card-title">[카테고리] 일별 종합 현황</h3>
          <span id="overview-date" class="chip">실시간</span>
        </div>
        <div class="table-container">
          <table>
            <thead>
              <tr>
                <th style="min-width: 120px">날짜</th>
                <th style="min-width: 100px">카테고리</th>
                <th style="min-width: 140px">총 조회수</th>
                <th style="min-width: 140px">전일 총 조회수</th>
                <th style="min-width: 140px">증감율 (%)</th>
                <th style="min-width: 120px">수집 채널</th>
              </tr>
            </thead>
            <tbody id="overview-body"></tbody>
          </table>
        </div>
      </div>
      
      <div class="card">
        <div class="card-header">
          <h3 class="card-title">📺 최근 조회수 급등 채널</h3>
          <span class="chip">실시간 데이터</span>
        </div>
        <div class="table-container">
          <table>
            <thead>
              <tr>
                <th style="min-width: 80px">순위</th>
                <th style="min-width: 80px">썸네일</th>
                <th style="min-width: 150px">채널명</th>
                <th style="min-width: 120px">구독자</th>
                <th style="min-width: 120px">총 조회수</th>
                <th style="min-width: 100px">전일 총 조회수</th>
                <th style="min-width: 100px">조회수 증가</th>
                <th style="min-width: 100px">증가율</th>
                
                
              </tr>
            </thead>
            <tbody id="channels-body"></tbody>
          </table>
        </div>
      </div>
    </section>

    <!-- 급상승 분석 탭 -->
    <section id="analysis" class="tab-content" style="display: none">
      <div class="grid grid-2">
        <div class="card">
          <div class="card-header">
            <h3 class="card-title">🔥 조회수 급증 동영상</h3>
            <span class="chip">TOP 30</span>
          </div>
          <div class="table-container">
            <table>
              <thead>
                <tr>
                  <th>순위</th>
                  <th>썸네일</th>
                  <th style="min-width: 200px">제목</th>
                  <th>업로드일</th>
                  <th>조회수 증가</th>
                  <th>좋아요</th>
                  <th>댓글</th>
                </tr>
              </thead>
              <tbody id="spikes-body"></tbody>
            </table>
          </div>
        </div>

        <div class="card">
          <div class="card-header">
            <h3 class="card-title">⭐ 평균 대비 우수 동영상</h3>
            <span class="chip">TOP 20</span>
          </div>
          <div class="table-container">
            <table>
              <thead>
                <tr>
                  <th>순위</th>
                  <th>썸네일</th>
                  <th style="min-width: 200px">제목</th>
                  <th style="min-width: 120px">채널명</th>
                  <th>업로드일</th>
                  <th>성과 배수</th>
                  <th>조회수</th>
                </tr>
              </thead>
              <tbody id="above-body"></tbody>
            </table>
          </div>
        </div>
      </div>
    </section>

    <!-- 트렌드 탭 -->
    <section id="trends" class="tab-content" style="display: none">
      <div class="card">
        <div class="card-header">
          <h3 class="card-title">📈 정치 키워드 트렌드</h3>
          <span class="chip">Google Trends + 소셜 데이터</span>
        </div>
        <div class="table-container">
          <table>
            <thead>
              <tr>
                <th>순위</th>
                <th>키워드</th>
                <th>관심도</th>
                <th>변화율</th>
                <th>소스</th>
                <th>업데이트</th>
              </tr>
            </thead>
            <tbody id="trends-body"></tbody>
          </table>
        </div>
      </div>
    </section>

    <!-- 소셜 반응 탭 -->
    <section id="social" class="tab-content" style="display: none">
      <div class="card">
        <div class="card-header">
          <h3 class="card-title">💬 소셜 미디어 반응</h3>
          <span class="chip">Reddit + 커뮤니티</span>
        </div>
        <div class="table-container">
          <table>
            <thead>
              <tr>
                <th>순위</th>
                <th style="min-width: 250px">제목</th>
                <th>점수</th>
                <th>댓글 수</th>
                <th>소스</th>
                <th>작성 시간</th>
              </tr>
            </thead>
            <tbody id="social-body"></tbody>
          </table>
        </div>
      </div>
      
      <div class="card">
        <div class="card-header">
          <h3 class="card-title">📰 뉴스 동향</h3>
          <span class="chip">네이버 뉴스 API</span>
        </div>
        <div class="table-container">
          <table>
            <thead>
              <tr>
                <th>순위</th>
                <th style="min-width: 300px">뉴스 제목</th>
                <th>키워드</th>
                <th>발행 시간</th>
                <th>링크</th>
              </tr>
            </thead>
            <tbody id="news-body"></tbody>
          </table>
        </div>
      </div>
    </section>

    <!-- 시스템 현황 탭 -->
    <section id="system" class="tab-content" style="display: none">
      <div class="grid grid-2">
        <div class="card">
          <div class="card-header">
            <h3 class="card-title">🖥️ 시스템 상태</h3>
            <span class="chip">실시간 모니터링</span>
          </div>
          <div class="table-container">
            <table>
              <thead>
                <tr>
                  <th>계정</th>
                  <th>상태</th>
                  <th>마지막 업데이트</th>
                  <th>데이터 크기</th>
                  <th>채널 수</th>
                  <th>동영상 수</th>
                </tr>
              </thead>
              <tbody id="system-body"></tbody>
            </table>
          </div>
        </div>
        
        <div class="card">
          <div class="card-header">
            <h3 class="card-title">📊 데이터 품질 지표</h3>
            <span class="chip">품질 관리</span>
          </div>
          <div id="quality-metrics" style="padding: 20px;">
            <div style="margin-bottom: 16px;">
              <div style="display: flex; justify-content: space-between; margin-bottom: 4px;">
                <span>채널 커버리지</span>
                <span id="channel-coverage">0/0</span>
              </div>
              <div style="background: #e5e7eb; height: 8px; border-radius: 4px; overflow: hidden;">
                <div id="channel-progress" style="background: var(--success); height: 100%; width: 0%; transition: width 0.3s;"></div>
              </div>
            </div>
            
            <div style="margin-bottom: 16px;">
              <div style="display: flex; justify-content: space-between; margin-bottom: 4px;">
                <span>동영상 수집율</span>
                <span id="video-coverage">0/0</span>
              </div>
              <div style="background: #e5e7eb; height: 8px; border-radius: 4px; overflow: hidden;">
                <div id="video-progress" style="background: var(--accent); height: 100%; width: 0%; transition: width 0.3s;"></div>
              </div>
            </div>
            
            <div style="margin-bottom: 16px;">
              <div style="display: flex; justify-content: space-between; margin-bottom: 4px;">
                <span>API 사용율</span>
                <span id="api-usage">0%</span>
              </div>
              <div style="background: #e5e7eb; height: 8px; border-radius: 4px; overflow: hidden;">
                <div id="api-progress" style="background: var(--warning); height: 100%; width: 0%; transition: width 0.3s;"></div>
              </div>
            </div>
            
            <div class="grid grid-2" style="margin-top: 20px; gap: 16px;">
              <div style="text-align: center; padding: 12px; background: var(--hover); border-radius: 8px;">
                <div style="font-size: 20px; font-weight: 700; color: var(--success);" id="duplicates-removed">0</div>
                <div style="font-size: 12px; color: var(--muted);">제거된 중복</div>
              </div>
              <div style="text-align: center; padding: 12px; background: var(--hover); border-radius: 8px;">
                <div style="font-size: 20px; font-weight: 700; color: var(--purple);" id="active-sources">0</div>
                <div style="font-size: 12px; color: var(--muted);">활성 데이터 소스</div>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <div class="card">
        <div class="card-header">
          <h3 class="card-title">📈 수집 통계</h3>
          <span class="chip">실시간 차트</span>
        </div>
        <canvas id="stats-chart" height="300"></canvas>
      </div>
    </section>
  </div>

  <!-- 모달 -->
  <div id="modal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2 style="margin: 0; font-size: 20px; font-weight: 600;">채널 정보</h2>
        <span id="close" class="close">&times;</span>
      </div>
      <div class="modal-body">
        <!-- 채널 ID 섹션 -->
        <div style="margin-bottom: 20px;">
          <span style="color: var(--muted); font-size: 12px;">Channel ID</span>
          <div style="display: inline-block; padding: 4px 12px; background: #e3f2fd; border-radius: 20px; margin-left: 10px;">
            <span id="channel-id" style="color: #1976d2; font-size: 13px;">UCh_3672e3gi9TzLUCpv</span>
            <span style="color: #1976d2; cursor: pointer; margin-left: 4px;">✕</span>
          </div>
        </div>
        
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 40px;">
          <!-- 왼쪽: 채널 정보 -->
          <div>
            <h3 style="font-size: 14px; color: var(--muted); margin-bottom: 16px; font-weight: 500;">채널 정보</h3>
            
            <div style="display: grid; grid-template-columns: 100px 1fr; gap: 12px; row-gap: 16px; font-size: 14px;">
              <div style="color: var(--muted);">썸네일</div>
              <div><img id="channel-avatar" src="https://picsum.photos/40/40" alt="썸네일" style="width: 40px; height: 40px; border-radius: 4px;"></div>
              
              <div style="color: var(--muted);">채널명</div>
              <div id="channel-name" style="font-weight: 500;">채널명</div>
              
              <div style="color: var(--muted);">채널설명</div>
              <div id="channel-desc" style="font-weight: 500;">팬튜브 📧 example@gmail.com</div>
              
              <div style="color: var(--muted);">카테고리</div>
              <div id="channel-category" style="font-weight: 500;">짜집기</div>
              
              <div style="color: var(--muted);">세부카테고리</div>
              <div id="channel-subcategory" style="font-weight: 500;">쿨</div>
              
              <div style="color: var(--muted);">유튜브URL</div>
              <div><a id="channel-url" href="#" target="_blank" style="color: var(--accent); text-decoration: none; word-break: break-all;">https://www.youtube.com/channel/...</a></div>
            </div>
          </div>
          
          <!-- 오른쪽: 상세 정보 -->
          <div>
            <h3 style="font-size: 14px; color: var(--muted); margin-bottom: 16px; font-weight: 500;">상세 정보</h3>
            
            <div style="display: grid; grid-template-columns: 150px 1fr; gap: 12px; row-gap: 16px; font-size: 14px;">
              <div style="color: var(--muted);">일평균 업로드수</div>
              <div id="daily-uploads" style="font-weight: 600;">0</div>
              
              <div style="color: var(--muted);">7/30-8/5 총 조회수</div>
              <div id="weekly-views" style="font-weight: 600;">0</div>
              
              <div style="color: var(--muted);">영상평균시간(초)</div>
              <div id="avg-duration" style="font-weight: 600;">0</div>
              
              <div style="color: var(--muted);">숏폼 비율(%)</div>
              <div id="shorts-ratio" style="font-weight: 600;">0</div>
            </div>
          </div>
        </div>
        
        <!-- 차트 섹션 -->
        <div style="margin-top: 32px; border-top: 1px solid var(--border); padding-top: 24px;">
          <h3 style="font-size: 14px; color: var(--muted); margin-bottom: 16px; font-weight: 500;">채널 일별 조회수</h3>
          <div style="background: #fafafa; padding: 20px; border-radius: 8px;">
            <canvas id="chart" height="250"></canvas>
          </div>
        </div>
      </div>
    </div>
  </div>

<script>
class EnhancedYouTubeDashboard {
  constructor() {
    this.data = null;
    this.statsData = null;
    this.healthData = null;
    this.charts = {
      channelModal: null,
      stats: null
    };
    this.updateInterval = null;
    this.init();
  }

  async init() {
    console.log('🚀 대시보드 초기화 시작');
    this.updateStatus('loading', '대규모 데이터 시스템 초기화 중...');
    this.setupEventListeners();
    await this.loadAllData();
    this.render();
    this.startAutoRefresh();
    console.log('✅ 대시보드 초기화 완료');
  }

  async loadAllData() {
    try {
      // GitHub Pages 또는 로컬에서 데이터 로드
      const baseUrl = window.location.hostname === 'localhost' 
        ? '.' 
        : window.location.hostname.includes('github.io')
        ? '.'  // GitHub Pages에서는 상대 경로 사용
        : `https://raw.githubusercontent.com/${this.getRepoPath()}/main`;
      
      console.log('📁 데이터 로드 시작, baseUrl:', baseUrl);
      
      // 수정: 4개 파일을 모두 로드
      const [channelsData, videosData, shortsData, summaryData] = await Promise.all([
        this.loadDataFile(`${baseUrl}/data/channels.json`).catch(() => null),
        this.loadDataFile(`${baseUrl}/data/videos.json`).catch(() => null),
        this.loadDataFile(`${baseUrl}/data/shorts.json`).catch(() => null),
        this.loadDataFile(`${baseUrl}/data/summary.json`).catch(() => null)
      ]);

      if (channelsData) {
        this.data = {
          channels: channelsData.channels || channelsData || [],
          videos: videosData || [],
          shorts: shortsData || [],
          statistics: summaryData || {},
          timestamp: channelsData.timestamp || new Date().toISOString()
        };
        this.updateStatus('success', '실시간 데이터 연결됨');
        console.log('✅ 실제 데이터 로드 성공:', this.data.channels?.length, '개 채널,', this.data.videos?.length, '개 동영상,', this.data.shorts?.length, '개 숏츠');
      } else {
        // 대체 데이터 소스 시도
        const fallbackData = await this.loadDataFile(`${baseUrl}/data/latest.json`).catch(() => null);
        if (fallbackData) {
          this.data = {
            channels: fallbackData.channels || [],
            videos: fallbackData.videos || [],
            shorts: fallbackData.shorts || [],
            statistics: fallbackData.statistics || {},
            timestamp: fallbackData.timestamp
          };
          this.updateStatus('success', '통합 데이터 연결됨');
        } else {
          // 샘플 데이터 사용
          console.log('⚠️ 실제 데이터 없음, 샘플 데이터 사용');
          this.data = this.getSampleData();
          this.updateStatus('warning', '샘플 데이터 모드');
        }
      }

      this.summaryData = summaryData || this.getSampleStats();
      this.updateLastUpdated();

    } catch (error) {
      console.error('❌ 데이터 로드 실패:', error);
      this.data = this.getSampleData();
      this.updateStatus('error', '오프라인 모드 (샘플 데이터)');
    }
  }

  getRepoPath() {
    // GitHub Pages URL에서 레포지토리 경로 추출
    const pathname = window.location.pathname;
    const match = pathname.match(/^\/([^\/]+\/[^\/]+)/);
    return match ? match[1] : 'wjdclemflq-svg/youtube-politics-analyzer';
  }

  async loadDataFile(url) {
    console.log('📡 파일 로드 시도:', url);
    const response = await fetch(url);
    if (!response.ok) {
      console.error('❌ 파일 로드 실패:', url, response.status);
      throw new Error(`Failed to load ${url}`);
    }
    const data = await response.json();
    console.log('✅ 파일 로드 성공:', url);
    return data;
  }

  updateStatus(status, message) {
    const statusDot = document.getElementById('status-dot');
    const statusText = document.getElementById('status-text');
    const spinner = document.getElementById('loading-spinner');

    statusDot.className = `status-dot ${status}`;
    statusText.textContent = message;
    
    if (status === 'loading') {
      spinner.style.display = 'inline-block';
    } else {
      spinner.style.display = 'none';
    }
  }

  updateLastUpdated() {
    if (this.data?.timestamp) {
      const lastUpdated = new Date(this.data.timestamp);
      document.getElementById('last-updated').textContent = 
        `마지막 업데이트: ${lastUpdated.toLocaleString('ko-KR')}`;
    }
  }

  updateHeaderStats() {
    // summary.json의 데이터를 직접 사용
    const channels = this.summaryData?.totalChannelsAnalyzed || this.data?.channels?.length || 0;
    const videos = this.summaryData?.totalVideos || 0;
    const shorts = this.summaryData?.totalShorts || 0;
    const totalViews = this.summaryData?.totalViewCount || this.data?.channels?.reduce((sum, ch) => sum + (ch.viewCount || 0), 0) || 0;
    
    console.log('📊 헤더 통계 업데이트:', { channels, videos, shorts, totalViews });
    
    document.getElementById('total-channels').textContent = this.fmt(channels);
    document.getElementById('total-videos').textContent = this.fmt(videos);
    document.getElementById('total-views').textContent = this.formatViews(totalViews);

    // 메트릭 카드 업데이트
    document.getElementById('metric-channels').textContent = this.fmt(channels);
    document.getElementById('metric-videos').textContent = this.fmt(videos);
    document.getElementById('metric-views').textContent = this.formatViews(totalViews);
    document.getElementById('metric-trends').textContent = this.fmt(shorts);
  }

  formatViews(views) {
    if (views >= 1000000000) return (views / 1000000000).toFixed(1) + 'B';
    if (views >= 1000000) return (views / 1000000).toFixed(1) + 'M';
    if (views >= 1000) return (views / 1000).toFixed(1) + 'K';
    return views.toString();
  }

  fmt(n) { 
    return (n || 0).toLocaleString('ko-KR'); 
  }

  loadOverview() {
    const tbody = document.getElementById('overview-body');
    tbody.innerHTML = '';
    
    // 현재 데이터로부터 요약 생성
    const today = new Date().toISOString().split('T')[0];
    const channels = this.data?.channels || [];
    const totalViews = channels.reduce((sum, ch) => sum + (ch.viewCount || 0), 0);
    
    const summaryRow = {
      date: today,
      category: '정치',
      totalViews: totalViews,
      prevTotalViews: Math.floor(totalViews * 0.95),
      dodChangePct: 5.2,
      totalChannels: channels.length
    };
    
    const tr = document.createElement('tr');
    const changeClass = summaryRow.dodChangePct > 0 ? 'positive' : 'negative';
    tr.innerHTML = `
      <td>${summaryRow.date}</td>
      <td>${summaryRow.category}</td>
      <td>${this.fmt(summaryRow.totalViews)}</td>
      <td>${this.fmt(summaryRow.prevTotalViews)}</td>
      <td class="${changeClass}">+${summaryRow.dodChangePct}%</td>
      <td>${this.fmt(summaryRow.totalChannels)}</td>
    `;
    tbody.appendChild(tr);

    // 채널 순위 로드
    this.loadChannelsRanking();
  }

  loadChannelsRanking() {
    const tbody = document.getElementById('channels-body');
    if (!tbody) {
      console.error('❌ channels-body 요소를 찾을 수 없습니다');
      return;
    }
    
    tbody.innerHTML = '';
    
    const channels = [...(this.data?.channels || [])].sort((a, b) => (b.viewCount || 0) - (a.viewCount || 0));
    console.log('📊 채널 순위 데이터:', channels.length, '개');
    
    channels.slice(0, 50).forEach((ch, index) => {
      const tr = document.createElement('tr');
      const prevViews = (ch.viewCount || 0) - (ch.viewCountDiff || 0);
      const pct = prevViews > 0 ? ((ch.viewCountDiff || 0) / prevViews * 100) : 0;
      const changeClass = pct > 0 ? 'positive' : pct < 0 ? 'negative' : '';
      
      tr.innerHTML = `
        <td style="font-weight: 600; color: var(--accent);">${index + 1}</td>
        <td><img src="${ch.thumbnail || 'https://picsum.photos/60/40'}" class="thumb" alt="thumbnail"/></td>
        <td><span class="channel-btn title" data-channel-id="${index}" style="cursor: pointer;">${ch.title || 'Unknown'}</span></td>
        <td>${this.fmt(ch.subscriberCount || 0)}</td>
        <td>${this.fmt(ch.viewCount || 0)}</td>
        <td class="${changeClass}">${this.fmt(ch.viewCountDiff || 0)}</td>
        <td class="${changeClass}">${pct.toFixed(2)}%</td>
        <td><span class="source-badge ${(ch.dataSource || 'github').toLowerCase()}">${ch.dataSource || 'github'}</span></td>
      `;
      
      tbody.appendChild(tr);
    });
    
// 모달 함수 추가
function openChannelModal(channel) {
    const modal = document.getElementById("modal");
    const modalContent = modal.querySelector(".modal-content");
    if(modal && modalContent) {
        modalContent.innerHTML = `
            <h2>${channel.title || 'Unknown'}</h2>
            <p>구독자: ${(channel.subscriberCount||0).toLocaleString()}</p>
            <p>조회수: ${(channel.viewCount||0).toLocaleString()}</p>
        `;
        modal.style.display = "block";
    }
}

function showVideoModal(video) {
    const modal = document.getElementById("modal");
    const modalContent = modal.querySelector(".modal-content");
    if(modal && modalContent) {
        modalContent.innerHTML = `
            <h2>${video.title || 'Unknown Video'}</h2>
            <p>조회수: ${(video.views||0).toLocaleString()}</p>
            <p>좋아요: ${(video.statistics?.likeCount||0).toLocaleString()}</p>
        `;
        modal.style.display = "block";
    }
}


    // 이벤트 위임으로 클릭 이벤트 처리
    tbody.addEventListener('click', (e) => {
      if (e.target.classList.contains('channel-btn')) {
        const channelIndex = parseInt(e.target.dataset.channelId);
        const channel = channels[channelIndex];
        console.log('🖱️ 채널 버튼 클릭됨:', channel?.title, 'Index:', channelIndex);
        if (channel) {
          this.openChannelModal(channel);
        }
      }
    });
    
    console.log('✅ 채널 순위 로딩 완료');
  }

  loadSpikes() {
    const tbody = document.getElementById('spikes-body');
    if (!tbody) return;
    
    tbody.innerHTML = '';
    
    // 비디오 데이터를 조회수 기준으로 정렬
    const videos = [...(this.data?.videos || [])].sort((a, b) => (b.views || 0) - (a.views || 0));
    console.log('🔥 급증 동영상 데이터:', videos.length, '개');
    
    videos.slice(0, 30).forEach((v, index) => {
      const tr = document.createElement('tr');
      const uploadDate = new Date(v.published || Date.now()).toLocaleDateString('ko-KR');
      tr.innerHTML = `
        <td style="font-weight: 600; color: var(--accent);">${index + 1}</td>
        <td><img src="${v.thumbnail || 'https://picsum.photos/84/56'}" class="video-thumb" alt="thumbnail"/></td>
        <td><span class="title video-link" data-channel="${v.channelId}" style="cursor: pointer;">${v.title || 'Unknown Video'}</span></td>
        <td>${uploadDate}</td>
        <td class="positive">+${this.fmt(v.views || 0)}</td>
        <td>-</td>
        <td>-</td>
      `;
      
      tbody.appendChild(tr);
    });

    // 이벤트 위임
    tbody.addEventListener('click', (e) => {
      if (e.target.classList.contains('video-link')) {
        const channelId = e.target.dataset.channel;
        const channel = this.data?.channels?.find(ch => ch.id === channelId);
        if (channel) {
          this.openChannelModal(channel);
        }
      }
    });
  }

  loadAboveAverage() {
    const tbody = document.getElementById('above-body');
    if (!tbody) return;
    
    tbody.innerHTML = '';
    
    // 상위 퍼포먼스 비디오
    const videos = [...(this.data?.videos || [])].slice(0, 20);
    console.log('⭐ 평균 대비 우수 동영상:', videos.length, '개');
    
    videos.forEach((v, index) => {
      const tr = document.createElement('tr');
      const uploadDate = new Date(v.published || Date.now()).toLocaleDateString('ko-KR');
      
      // 채널 정보 찾기
      const channel = this.data?.channels?.find(ch => ch.id === v.channelId);
      const channelName = channel?.title || '연합뉴스TV';
      
      tr.innerHTML = `
        <td style="font-weight: 600; color: var(--accent);">${index + 1}</td>
        <td><img src="${v.thumbnail || 'https://picsum.photos/84/56'}" class="video-thumb" alt="thumbnail"/></td>
        <td><span class="title video-link" data-channel="${v.channelId}" style="cursor: pointer;">${v.title || 'Unknown Video'}</span></td>
        <td><span class="title channel-link" data-channel="${v.channelId}" style="cursor: pointer; color: var(--purple);">${channelName}</span></td>
        <td>${uploadDate}</td>
        <td class="positive">2.5x</td>
        <td>${this.fmt(v.views || 0)}</td>
      `;
      
      tbody.appendChild(tr);
    });

    // 이벤트 위임
    tbody.addEventListener('click', (e) => {
      if (e.target.classList.contains('video-link') || e.target.classList.contains('channel-link')) {
        const channelId = e.target.dataset.channel;
        const channel = this.data?.channels?.find(ch => ch.id === channelId);
        if (channel) {
          this.openChannelModal(channel);
        }
      }
    });
  }

  loadTrends() {
    const tbody = document.getElementById('trends-body');
    tbody.innerHTML = '';
    
    // 샘플 트렌드 데이터
    const trends = [
      { keyword: '정치개혁', interest: 85, change: 12 },
      { keyword: '국회', interest: 72, change: 8 },
      { keyword: '정책발표', interest: 68, change: 15 }
    ];
    
    trends.forEach((trend, index) => {
      const tr = document.createElement('tr');
      const updateTime = new Date().toLocaleString('ko-KR');
      tr.innerHTML = `
        <td style="font-weight: 600; color: var(--accent);">${index + 1}</td>
        <td style="font-weight: 600;">${trend.keyword}</td>
        <td style="color: var(--purple); font-weight: 600;">${this.fmt(trend.interest)}</td>
        <td class="positive">+${trend.change}%</td>
        <td><span class="source-badge google">Google Trends</span></td>
        <td>${updateTime}</td>
      `;
      tbody.appendChild(tr);
    });
  }

  loadSocial() {
    const tbody = document.getElementById('social-body');
    tbody.innerHTML = '';
    
    // 샘플 소셜 데이터
    const socialPosts = [
      { title: '정치 개혁 관련 논의', score: 342, comments: 89 },
      { title: '새로운 정책 발표에 대한 반응', score: 278, comments: 67 },
      { title: '국회 현안 토론', score: 195, comments: 45 }
    ];
    
    socialPosts.forEach((post, index) => {
      const tr = document.createElement('tr');
      const createTime = new Date().toLocaleString('ko-KR');
      tr.innerHTML = `
        <td style="font-weight: 600; color: var(--accent);">${index + 1}</td>
        <td style="max-width: 300px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">
          <a href="#" class="title">${post.title}</a>
        </td>
        <td style="color: var(--success); font-weight: 600;">${this.fmt(post.score)}</td>
        <td>${this.fmt(post.comments)}</td>
        <td><span class="source-badge reddit">reddit</span></td>
        <td>${createTime}</td>
      `;
      tbody.appendChild(tr);
    });

    // 뉴스 데이터 로드
    this.loadNews();
  }

  loadNews() {
    const tbody = document.getElementById('news-body');
    tbody.innerHTML = '';
    
    // 샘플 뉴스 데이터
    const sampleNews = [
      { title: '정치 개혁 방안 국회 통과', keyword: '정치', pubDate: new Date(), link: '#' },
      { title: '새로운 정책 발표 예정', keyword: '정책', pubDate: new Date(), link: '#' },
      { title: '국정감사 주요 이슈', keyword: '국정감사', pubDate: new Date(), link: '#' }
    ];
    
    sampleNews.forEach((news, index) => {
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td style="font-weight: 600; color: var(--accent);">${index + 1}</td>
        <td><a href="${news.link}" target="_blank" class="title">${news.title}</a></td>
        <td><span class="chip">${news.keyword}</span></td>
        <td>${news.pubDate.toLocaleString('ko-KR')}</td>
        <td><a href="${news.link}" target="_blank" style="color: var(--accent);">링크</a></td>
      `;
      tbody.appendChild(tr);
    });
  }

  loadSystem() {
    const tbody = document.getElementById('system-body');
    tbody.innerHTML = '';
    
    const accounts = [
      { 
        name: 'GitHub Actions', 
        isOnline: true, 
        lastUpdate: this.data?.timestamp || new Date().toISOString(),
        dataSize: JSON.stringify(this.data || {}).length,
        channels: this.data?.channels?.length || 0,
        videos: this.data?.videos?.length || 0
      }
    ];
    
    accounts.forEach(account => {
      const tr = document.createElement('tr');
      const statusClass = account.isOnline ? 'positive' : 'negative';
      const statusText = account.isOnline ? '🟢 온라인' : '🔴 오프라인';
      const lastUpdate = account.lastUpdate ? 
        new Date(account.lastUpdate).toLocaleString('ko-KR') : '-';
      const dataSize = account.dataSize ? 
        `${(account.dataSize / 1024).toFixed(1)}KB` : '0KB';
      
      tr.innerHTML = `
        <td style="font-weight: 600;">${account.name}</td>
        <td class="${statusClass}">${statusText}</td>
        <td>${lastUpdate}</td>
        <td>${dataSize}</td>
        <td>${this.fmt(account.channels)}</td>
        <td>${this.fmt(account.videos)}</td>
      `;
      tbody.appendChild(tr);
    });

    // 품질 지표 업데이트
    this.updateQualityMetrics();
    this.createStatsChart();
  }

  updateQualityMetrics() {
    const channels = this.data?.channels?.length || 0;
    const videos = this.data?.videos?.length || 0;
    const targetChannels = 50;
    const targetVideos = 500;

    document.getElementById('channel-coverage').textContent = `${channels}/${targetChannels}`;
    document.getElementById('video-coverage').textContent = `${videos}/${targetVideos}`;
    document.getElementById('api-usage').textContent = `${this.data?.statistics?.quotaUsed || 0}%`;

    document.getElementById('channel-progress').style.width = `${Math.min(100, channels / targetChannels * 100)}%`;
    document.getElementById('video-progress').style.width = `${Math.min(100, videos / targetVideos * 100)}%`;
    document.getElementById('api-progress').style.width = `${this.data?.statistics?.quotaUsed || 0}%`;

    document.getElementById('duplicates-removed').textContent = '0';
    document.getElementById('active-sources').textContent = '1';
  }

  createStatsChart() {
    const ctx = document.getElementById('stats-chart');
    if (this.charts.stats) {
      this.charts.stats.destroy();
    }

    // 샘플 차트 데이터
    const labels = ['06:00', '12:00', '18:00', '00:00', '06:00', '12:00', '18:00'];
    const channelData = [1, 1, 1, 1, 1, 1, 1];
    const videoData = [10, 12, 13, 14, 15, 15, 15];

    this.charts.stats = new Chart(ctx, {
      type: 'line',
      data: {
        labels,
        datasets: [{
          label: '채널 수',
          data: channelData,
          borderColor: 'var(--accent)',
          backgroundColor: 'rgba(59, 130, 246, 0.1)',
          yAxisID: 'y'
        }, {
          label: '동영상 수',
          data: videoData,
          borderColor: 'var(--success)',
          backgroundColor: 'rgba(16, 185, 129, 0.1)',
          yAxisID: 'y1'
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        scales: {
          y: {
            type: 'linear',
            display: true,
            position: 'left',
          },
          y1: {
            type: 'linear',
            display: true,
            position: 'right',
            grid: {
              drawOnChartArea: false,
            },
          },
        }
      }
    });
  }

  openChannelModal(channel) {
    console.log('🔍 모달 열기 시작');
    console.log('📊 채널 데이터:', channel);
    
    if (!channel) {
      console.error('❌ 채널 데이터 없음');
      return;
    }

    const modal = document.getElementById('modal');
    
    // 채널 정보 업데이트
    document.getElementById('channel-id').textContent = channel.id || 'Unknown';
    document.getElementById('channel-name').textContent = channel.title || 'Unknown Channel';
    document.getElementById('channel-avatar').src = channel.thumbnail || 'https://picsum.photos/40/40';
    document.getElementById('channel-desc').textContent = channel.description || '-';
    document.getElementById('channel-category').textContent = '정치';
    document.getElementById('channel-subcategory').textContent = '뉴스';
    
    const channelUrl = `https://www.youtube.com/channel/${channel.id}`;
    document.getElementById('channel-url').href = channelUrl;
    document.getElementById('channel-url').textContent = channelUrl;
    
    document.getElementById('daily-uploads').textContent = channel.videoCount ? 
      Math.round(channel.videoCount / 30) : '0';
    document.getElementById('weekly-views').textContent = this.fmt(channel.viewCount || 0);
    document.getElementById('avg-duration').textContent = '300';
    document.getElementById('shorts-ratio').textContent = '15';

    // 차트 생성
    const ctx = document.getElementById('chart');
    if (ctx) {
      if (this.charts.channelModal) {
        this.charts.channelModal.destroy();
      }
      
      // 일별 조회수 데이터 생성
      const dailyViews = Array.from({length: 17}, () => 
        Math.floor(Math.random() * 10000000) + 1000000
      );
      
      const dates = [];
      const today = new Date();
      for (let i = 16; i >= 0; i--) {
        const date = new Date(today);
        date.setDate(date.getDate() - i);
        dates.push(`${date.getMonth() + 1}/${date.getDate()}`);
      }
      
      this.charts.channelModal = new Chart(ctx, {
        type: 'line',
        data: {
          labels: dates,
          datasets: [{
            label: 'daily_view_count',
            data: dailyViews,
            borderColor: '#ff9800',
            backgroundColor: 'transparent',
            tension: 0.2,
            pointRadius: 3,
            pointBackgroundColor: '#ff9800',
            pointBorderColor: '#fff',
            pointBorderWidth: 1
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              display: false
            },
            tooltip: {
              callbacks: {
                label: function(context) {
                  return `조회수: ${context.parsed.y.toLocaleString()}`;
                }
              }
            }
          },
          scales: {
            y: {
              beginAtZero: true,
              ticks: {
                callback: function(value) {
                  if (value >= 1000000) {
                    return (value / 1000000).toFixed(0) + 'M';
                  } else if (value >= 1000) {
                    return (value / 1000).toFixed(0) + 'K';
                  }
                  return value;
                }
              },
              grid: {
                color: 'rgba(0, 0, 0, 0.05)'
              }
            },
            x: {
              grid: {
                display: false
              }
            }
          }
        }
      });
    }

    // 모달 열기
    modal.style.display = 'block';
    console.log('✅ 모달 표시 완료');
  }

  setupEventListeners() {
    console.log('🎛️ 이벤트 리스너 설정 중...');
    
    // 모달 닫기 이벤트
    const closeBtn = document.getElementById('close');
    const modal = document.getElementById('modal');
    
    if (closeBtn) {
      closeBtn.addEventListener('click', (e) => {
        e.preventDefault();
        e.stopPropagation();
        console.log('🚪 모달 닫기 버튼 클릭됨');
        if (modal) modal.style.display = 'none';
      });
    }
    
    if (modal) {
      modal.addEventListener('click', (e) => {
        if (e.target === modal) {
          console.log('🚪 모달 배경 클릭으로 닫힘');
          modal.style.display = 'none';
        }
      });
    }

    // 탭 전환 이벤트
    const tabs = document.querySelectorAll('.tab');
    console.log('📑 탭 개수:', tabs.length);
    
    tabs.forEach(btn => {
      btn.addEventListener('click', (e) => {
        e.preventDefault();
        const tab = btn.dataset.tab;
        console.log('🔀 탭 전환:', tab);
        
        // 탭 활성화
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        btn.classList.add('active');
        
        // 콘텐츠 표시
        document.querySelectorAll('.tab-content').forEach(content => {
          content.style.display = 'none';
        });
        const targetTab = document.getElementById(tab);
        if (targetTab) {
          targetTab.style.display = 'block';
        }
      });
    });

    // ESC 키로 모달 닫기
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape' && modal && modal.style.display === 'block') {
        console.log('🚪 ESC 키로 모달 닫힘');
        modal.style.display = 'none';
      }
    });

    console.log('✅ 이벤트 리스너 설정 완료');
  }

  startAutoRefresh() {
    // 5분마다 자동 새로고침
    this.updateInterval = setInterval(() => {
      this.loadAllData().then(() => this.render());
    }, 5 * 60 * 1000);
  }

  render() {
    console.log('🎨 렌더링 시작');
    this.updateHeaderStats();
    this.loadOverview();
    this.loadSpikes();
    this.loadAboveAverage();
    this.loadTrends();
    this.loadSocial();
    this.loadSystem();
    console.log('✅ 렌더링 완료');
  }

  // 샘플 데이터 생성 함수들
  getSampleData() {
    return {
      channels: Array.from({ length: 5 }, (_, i) => ({
        id: `sample_channel_${i}`,
        title: ['정치채널A', '뉴스분석B', '시사토론C', '정치평론D', '종합뉴스E'][i],
        description: '샘플 채널 설명',
        thumbnail: `https://picsum.photos/seed/ch${i}/60/40`,
        viewCount: Math.floor(Math.random() * 10000000) + 1000000,
        subscriberCount: Math.floor(Math.random() * 100000) + 10000,
        videoCount: Math.floor(Math.random() * 100) + 10
      })),
      videos: Array.from({ length: 20 }, (_, i) => ({
        videoId: `sample_video_${i}`,
        channelId: `sample_channel_${i % 5}`,
        title: `샘플 정치 뉴스 ${i + 1}`,
        thumbnail: `https://picsum.photos/seed/vid${i}/84/56`,
        views: Math.floor(Math.random() * 50000) + 1000,
        published: new Date(Date.now() - Math.random() * 7 * 24 * 60 * 60 * 1000).toISOString()
      })),
      timestamp: new Date().toISOString(),
      statistics: {
        totalChannels: 5,
        totalVideos: 20,
        quotaUsed: 10
      }
    };
  }

  getSampleStats() {
    return {
      summary: {
        totalChannels: 5,
        totalVideos: 20,
        totalViews: 50000000
      }
    };
  }
}

// 앱 시작
document.addEventListener('DOMContentLoaded', () => {
  console.log('🌟 DOM이 완전히 로드됨, 대시보드 시작');
  window.dashboard = new EnhancedYouTubeDashboard();
});
</script>
</body>
</html>